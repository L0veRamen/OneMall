let products = [
  {
    name: "Grape",
    tag: "grape",
    price: 2.99,
    incart: 0,
    img: "img/product_6002/grape_6002.jpg",
  },

  {
    name: "Orange",
    tag: "orange",
    price: 4.29,
    incart: 0,
    img: "img/product_6002/orange_6002.jpg",
  },

  {
    name: "Kiwi",
    tag: "kiwi",
    price: 6.68,
    incart: 0,
    img: "img/product_6002/kiwi_6002.jpeg",
  },

  {
    name: "Lemon",
    tag: "lemon",
    price: 6.99,
    incart: 0,
    img: "img/product_6002/lemon_6002.jpeg",
  },

  {
    name: "Pineapple",
    tag: "pineapple",
    price: 5.99,
    incart: 0,
    img: "img/product_6002/pineapple_6002.jpeg",
  },

  {
    name: "Watermelon",
    tag: "watermelon",
    price: 7.29,
    incart: 0,
    img: "img/product_6002/watermelon_6002.jpeg",
  },

  {
    name: "Broccoli",
    tag: "broccoli",
    price: 1.33,
    incart: 0,
    img: "img/product_9518/broccoli.jpg",
  },

  {
    name: "Cabbage",
    tag: "cabbage",
    price: 1.32,
    incart: 0,
    img: "img/product_9518/cabbage.jpg",
  },

  {
    name: "Carrots",
    tag: "carrots",
    price: 1.89,
    incart: 0,
    img: "img/product_9518/carrots.jpg",
  },

  {
    name: "Cucumber",
    tag: "cucumber",
    price: 1.78,
    incart: 0,
    img: "img/product_9518/cucumber.jpg",
  },

  {
    name: "Eggplant",
    tag: "eggplant",
    price: 3.5,
    incart: 0,
    img: "img/product_9518/Eggplant.jpg",
  },

  {
    name: "Mushroom",
    tag: "mushroom",
    price: 2.3,
    incart: 0,
    img: "img/product_9518/mushroom.jpg",
  },

  {
    name: "Bagel",
    tag: "bagel",
    price: 0.99,
    incart: 0,
    img: "img/product_xxxx/bagel_7808.jpeg",
  },

  {
    name: "Brownie",
    tag: "brownie",
    price: 1.99,
    incart: 0,
    img: "img/product_xxxx/brownie_7808.jpg",
  },

  {
    name: "Cake",
    tag: "cake",
    price: 5.99,
    incart: 0,
    img: "img/product_xxxx/cake_7808.jpg",
  },

  {
    name: "Croissant",
    tag: "croissant",
    price: 2.99,
    incart: 0,
    img: "img/product_xxxx/croissant_7808.jpg",
  },

  {
    name: "Baguette",
    tag: "baguette",
    price: 1.99,
    incart: 0,
    img: "img/product_xxxx/frenchBaguette_7808.jpg",
  },

  {
    name: "Muffin",
    tag: "muffin",
    price: 0.99,
    incart: 0,
    img: "img/product_xxxx/muffin_7808.jpg",
  },

  {
    name: "Lactancia",
    tag: "lactancia",
    price: 4.19,
    incart: 0,
    img: "images/Lactancia_2%25_2L_5067.png",
  },

  {
    name: "QUEBON",
    tag: "quebon",
    price: 7.69,
    incart: 0,
    img: "images/QUEBON_2%25_4L_5067.png",
  },

  {
    name: "Egg White",
    tag: "egg white",
    price: 4.69,
    incart: 0,
    img: "images/BRUNBRAE_Simply%20Egg%20White_500g_5067.png",
  },

  {
    name: "Large Eggs",
    tag: "large eggs",
    price: 4.49,
    incart: 0,
    img: "images/BRUNBRAE_Large_Eggs_30UN_5067.png",
  },

  {
    name: "Boild Eggs",
    tag: "boild eggs",
    price: 4.49,
    incart: 0,
    img: "images/BURNBRAE_Boiled_Eggs_5067.png",
  },

  {
    name: "Natrel",
    tag: "natrel",
    price: 4.49,
    incart: 0,
    img: "images/Natrel_2%25_2L_5067.png",
  },

  {
    name: "Beef",
    tag: "beef",
    price: 10.99,
    incart: 0,
    img: "img/product_xxxx/beef.jpg",
  },

  {
    name: "Lamb",
    tag: "lamb",
    price: 14.99,
    incart: 0,
    img: "img/product_xxxx/lamb.jpg",
  },

  {
    name: "Pork",
    tag: "pork",
    price: 8.99,
    incart: 0,
    img: "img/product_xxxx/pork.jpg",
  },

  {
    name: "Duck",
    tag: "duck",
    price: 12.99,
    incart: 0,
    img: "img/product_xxxx/duck.jpg",
  },

  {
    name: "Chicken",
    tag: "chicken",
    price: 7.99,
    incart: 0,
    img: "img/product_xxxx/chicken.jpg",
  },

  {
    name: "Ham",
    tag: "ham",
    price: 16.99,
    incart: 0,
    img: "img/product_xxxx/ham.jfif",
  },

  {
    name: "Salmon",
    tag: "salmon",
    price: 3.99,
    incart: 0,
    img: "img/product_8623/salmon_8623.jpg",
  },

  {
    name: "Shrimp",
    tag: "shrimp",
    price: 4.89,
    incart: 0,
    img: "img/product_8623/shrimp_8623.jpg",
  },

  {
    name: "Squid",
    tag: "squid",
    price: 5.48,
    incart: 0,
    img: "img/product_8623/squid_8623.jpg",
  },

  {
    name: "Crab",
    tag: "crab",
    price: 7.99,
    incart: 0,
    img: "img/product_8623/crab_8623.jpg",
  },

  {
    name: "Mackerel",
    tag: "mackerel",
    price: 8.99,
    incart: 0,
    img: "img/product_8623/mackerel_8623.jpg",
  },

  {
    name: "Scallop",
    tag: "scallop",
    price: 8.29,
    incart: 0,
    img: "img/product_8623/scallop_8623.jpg",
  },
];

function calculate() {
  var quantity = $("#quan").val().trim();
  var price = parseFloat($("#price").text().substring(1));
  var total = (quantity * price).toFixed(2);
  console.log(quantity);
  console.log(price);
  $("#tt").css("font-size", "20px");
  $("#tt").css("font-family", "Courier");
  $("#tt").css("font-weight", "bolder");
  $("#tt").text("$" + total);
  $("#tt").slideUp(750);
  if (quantity != "" && !isNaN(total)) {
    $("#rt").css("font-size", "20px");
    $("#rt").css("color", "red");
    $("#rt").css("font-family", "Courier");
    $("#rt").css("font-weight", "bolder");
    $("#rt").slideDown(750);
    $("#rt").slideUp(750);
  }
}

function add(tag) {
  for (let product of products) {
    if (product.tag == tag) {
      cartNumbers(product, 1);
      totalCost(product, 1);
      break;
    }
  }
}

function addQuantity(tag, e) {
  calculate();
  var parent = e.parentNode;
  var value = parent.querySelector("input[type=number]").value;
  for (let product of products) {
    if (product.tag == tag) {
      cartNumbers(product, value * 1);
      totalCost(product, value * 1);
      break;
    }
  }
}

function onLoadCartNumbers() {
  let productNumbers = localStorage.getItem("cartNumbers");

  if (productNumbers) {
    document.querySelector(".sc span").textContent = productNumbers;
  }
}

function cartNumbers(product, quantity) {
  let productNumbers = localStorage.getItem("cartNumbers");

  productNumbers = parseInt(productNumbers) * 1;

  if (productNumbers) {
    localStorage.setItem("cartNumbers", productNumbers + quantity);
    document.querySelector(".sc span").textContent = productNumbers + quantity;
  } else {
    localStorage.setItem("cartNumbers", quantity);
    document.querySelector(".sc span").textContent = quantity;
  }

  setItems(product, quantity);
}

function setItems(product, quantity) {
  let cartItems = localStorage.getItem("productsInCart");
  cartItems = JSON.parse(cartItems);

  if (cartItems != null) {
    if (cartItems[product.tag] == undefined) {
      product.incart = quantity;
    } else {
      product.incart += quantity;
    }
    cartItems[product.tag] = product;
  } else {
    product.incart = quantity;
    cartItems = {
      [product.tag]: product,
    };
  }

  localStorage.setItem("productsInCart", JSON.stringify(cartItems));
  console.log("My cartItems are", cartItems);
}

function loadDisplayItems() {
  let cartItems = localStorage.getItem("productsInCart");
  let cartProducts = JSON.parse(cartItems);

  //items in cart
  var cart_table = document.getElementById("cart_table");
  cart_table.innerHTML = "";

  if (cartProducts) {
    for (var key in cartProducts) {
      if (cartProducts.hasOwnProperty(key)) {
        var product = cartProducts[key];
        var row = cart_table.insertRow(0);
        var cell0 = row.insertCell(0);
        var cell1 = row.insertCell(1);
        var cell2 = row.insertCell(2);

        var txt0 = buildCell0Html(product);
        var txt1 = buildCell1Html(product);
        var txt2 = "$" + (product.price * product.incart).toFixed(2);

        cell0.innerHTML = txt0;
        cell1.innerHTML = txt1;
        cell2.innerHTML = txt2;
      }
    }
  }

  //header in cart table
  var header = cart_table.insertRow(0);
  var headerCell = document.createElement("th");
  headerCell.innerHTML = "Product";
  header.appendChild(headerCell);

  headerCell = document.createElement("th");
  headerCell.innerHTML = "Quantity";
  header.appendChild(headerCell);

  headerCell = document.createElement("th");
  headerCell.innerHTML = "Subtotal";
  header.appendChild(headerCell);

  //total items
  var ti = document.getElementById("ti");
  var cartNumbers = localStorage.getItem("cartNumbers");
  if (!cartNumbers) {
    cartNumbers = 0;
  }
  ti.innerHTML = cartNumbers;

  var totalCost = localStorage.getItem("totalCost");
  if (!totalCost) {
    totalCost = 0;
  }
  var st_number = parseFloat(totalCost).toFixed(2);
  var qst_number = (st_number * 0.0975).toFixed(2);
  var gst_number = (st_number * 0.05).toFixed(2);
  var tt_number = (st_number * 1 + qst_number * 1 + gst_number * 1).toFixed(2);

  //subtotal
  var st = document.getElementById("st");
  st.innerHTML = "$" + st_number;

  //qst
  var qst = document.getElementById("qst");
  qst.innerHTML = "$" + qst_number;

  //gst
  var gst = document.getElementById("gst");
  gst.innerHTML = "$" + gst_number;

  //gst
  var tt = document.getElementById("tt");
  tt.innerHTML = "$" + tt_number;
}

function buildCell0Html(product) {
  var txt = '<div id="' + product.tag + '" class="cart-info">';
  txt = txt + "<img src= " + product.img + ">";
  txt = txt + "<div>";
  txt = txt + "<p>" + product.name + "</p>";
  txt = txt + "<small>Price: $" + product.price + "</small>";
  txt = txt + "<br>";
  txt =
    txt +
    "<button onclick=\"removeItem('" +
    product.tag +
    '\')" class="rm">Remove</button>';
  txt =
    txt + '<a href="Index_5067.html"><button>continue shopping</button></a>';
  txt = txt + "</div>";
  txt = txt + "</div>";

  return txt;
}
function buildCell1Html(product) {
  var txt =
    '<input type="number" value="' +
    product.incart +
    '"  onkeyup="changeQuantity(\'' +
    product.tag +
    '\',this)"  min="0" >';
  return txt;
}

function changeQuantity(tag, e) {
  console.log(tag + "--" + e.value);

  if (e.value) {
    if (e.value <= 0) {
      removeItem(tag);
    } else {
      let cartItems = localStorage.getItem("productsInCart");
      let cartProducts = JSON.parse(cartItems);

      var cartNumbers = 0;
      var totalCost = 0.0;
      for (var key in cartProducts) {
        if (cartProducts.hasOwnProperty(key)) {
          var product = cartProducts[key];
          if (product.tag == tag) {
            product.incart = e.value;
          }
          cartNumbers += product.incart * 1;
          totalCost += product.price * product.incart;
        }
      }
      localStorage.setItem("productsInCart", JSON.stringify(cartProducts));
      localStorage.setItem("cartNumbers", JSON.stringify(cartNumbers));
      localStorage.setItem("totalCost", JSON.stringify(totalCost));

      loadDisplayItems();
    }
  }
}
function removeItem(tag) {
  let cartItems = localStorage.getItem("productsInCart");
  let cartProducts = JSON.parse(cartItems);

  var product_remove = cartProducts[tag];

  var cartNumbers = localStorage.getItem("cartNumbers");
  var cartNumbers_number = parseInt(cartNumbers);
  cartNumbers_number = cartNumbers_number - product_remove.incart;

  var totalCost = localStorage.getItem("totalCost");
  var totalCost_number = parseFloat(totalCost);
  totalCost_number =
    totalCost_number - product_remove.price * product_remove.incart;

  delete cartProducts[tag];

  localStorage.setItem("productsInCart", JSON.stringify(cartProducts));
  localStorage.setItem("cartNumbers", JSON.stringify(cartNumbers_number));
  localStorage.setItem("totalCost", JSON.stringify(totalCost_number));

  document.querySelector(".sc span").textContent = cartNumbers_number;

  loadDisplayItems();
}

function totalCost(products, quantity) {
  //console.log("The product price is",product.price);
  let cartCost = localStorage.getItem("totalCost");

  //localStorage.setItem("totalCost", products.price);

  console.log("My cartCost is", cartCost);
  console.log(typeof cartCost);

  if (cartCost != null) {
    cartCost = parseFloat(cartCost).toFixed(2) * 1;
    localStorage.setItem(
      "totalCost",
      (cartCost + products.price * quantity).toFixed(2)
    );
  } else {
    localStorage.setItem("totalCost", products.price * quantity);
  }
}

function emptyCart() {
  localStorage.clear();

  for (let product of products) {
    product.incart = 0;
  }
  document.querySelector(".sc span").textContent = 0;
  loadDisplayItems();
}

onLoadCartNumbers();
